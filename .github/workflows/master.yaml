{
   "jobs": {
      "build_and_test": {
         "name": "build_and_test ${{ matrix.host.os }}",
         "runs-on": "${{ matrix.host.os }}",
         "steps": [
            {
               "name": "Check out source code",
               "uses": "actions/checkout@v1"
            },
            {
               "name": "Installing Bazel",
               "run": "v=$(cat .bazelversion) && curl -L https://github.com/bazelbuild/bazel/releases/download/${v}/bazel-${v}-${{matrix.host.bazel_os}}-x86_64 > ~/bazel && chmod +x ~/bazel && echo ~ >> ${GITHUB_PATH}",
               "shell": "bash"
            },
            {
               "if": "matrix.host.platform_name == 'windows_amd64'",
               "name": "Override .bazelrc",
               "run": "echo \"startup --output_base=D:/bazel_output\" >> .bazelrc"
            },
            {
               "if": "matrix.host.lint",
               "name": "Bazel mod tidy",
               "run": "bazel mod tidy"
            },
            {
               "if": "matrix.host.lint",
               "name": "Gazelle",
               "run": "rm -f $(find . -name '*.pb.go' | sed -e 's/[^/]*$/BUILD.bazel/') && bazel run //:gazelle"
            },
            {
               "if": "matrix.host.lint",
               "name": "Buildifier",
               "run": "bazel run @com_github_bazelbuild_buildtools//:buildifier"
            },
            {
               "if": "matrix.host.lint",
               "name": "Gofmt",
               "run": "bazel run @cc_mvdan_gofumpt//:gofumpt -- -w -extra $(pwd)"
            },
            {
               "if": "matrix.host.lint",
               "name": "Clang format",
               "run": "find . -name '*.proto' -exec bazel run @llvm_toolchain_llvm//:bin/clang-format -- -i {} +"
            },
            {
               "if": "matrix.host.lint",
               "name": "GitHub workflows",
               "run": "bazel build //tools/github_workflows && cp bazel-bin/tools/github_workflows/*.yaml .github/workflows"
            },
            {
               "if": "matrix.host.lint",
               "name": "Protobuf generation",
               "run": "if [ -d pkg/proto ]; then\n  find . bazel-bin/pkg/proto -name '*.pb.go' -delete || true\n  bazel build $(bazel query --output=label 'kind(\"go_proto_library\", //...)')\n  find bazel-bin/pkg/proto -name '*.pb.go' | while read f; do\n    cat $f > $(echo $f | sed -e 's|.*/pkg/proto/|pkg/proto/|')\n  done\nfi\n"
            },
            {
               "if": "matrix.host.lint",
               "name": "Embedded asset generation",
               "run": "bazel build $(git grep '^[[:space:]]*//go:embed ' | sed -e 's|\\(.*\\)/.*//go:embed |//\\1:|; s|\"||g; s| .*||' | sort -u)\ngit grep '^[[:space:]]*//go:embed ' | sed -e 's|\\(.*\\)/.*//go:embed |\\1/|' | while read o; do\n  if [ -e \"bazel-bin/$o\" ]; then\n    rm -rf \"$o\"\n    cp -r \"bazel-bin/$o\" \"$o\"\n    find \"$o\" -type f -exec chmod -x {} +\n  fi\ndone\n"
            },
            {
               "if": "matrix.host.lint",
               "name": "Test style conformance",
               "run": "git add . && git diff --exit-code HEAD --"
            },
            {
               "if": "matrix.host.cross_compile || matrix.host.platform_name == 'linux_amd64'",
               "name": "linux_amd64: build${{ matrix.host.platform_name == 'linux_amd64' && ' and test' || '' }}",
               "run": "bazel ${{ matrix.host.platform_name == 'linux_amd64' && 'test --test_output=errors' || 'build' }} --platforms=@rules_go//go/toolchain:linux_amd64 //..."
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_amd64: copy bonanza_bazel",
               "run": "rm -f bonanza_bazel && bazel run --run_under cp --platforms=@rules_go//go/toolchain:linux_amd64 //cmd/bonanza_bazel $(pwd)/bonanza_bazel"
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_amd64: upload bonanza_bazel",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_bazel.linux_amd64",
                  "path": "bonanza_bazel"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_amd64: copy bonanza_browser",
               "run": "rm -f bonanza_browser && bazel run --run_under cp --platforms=@rules_go//go/toolchain:linux_amd64 //cmd/bonanza_browser $(pwd)/bonanza_browser"
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_amd64: upload bonanza_browser",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_browser.linux_amd64",
                  "path": "bonanza_browser"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_amd64: copy bonanza_builder",
               "run": "rm -f bonanza_builder && bazel run --run_under cp --platforms=@rules_go//go/toolchain:linux_amd64 //cmd/bonanza_builder $(pwd)/bonanza_builder"
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_amd64: upload bonanza_builder",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_builder.linux_amd64",
                  "path": "bonanza_builder"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_amd64: copy bonanza_fetcher",
               "run": "rm -f bonanza_fetcher && bazel run --run_under cp --platforms=@rules_go//go/toolchain:linux_amd64 //cmd/bonanza_fetcher $(pwd)/bonanza_fetcher"
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_amd64: upload bonanza_fetcher",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_fetcher.linux_amd64",
                  "path": "bonanza_fetcher"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_amd64: copy bonanza_scheduler",
               "run": "rm -f bonanza_scheduler && bazel run --run_under cp --platforms=@rules_go//go/toolchain:linux_amd64 //cmd/bonanza_scheduler $(pwd)/bonanza_scheduler"
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_amd64: upload bonanza_scheduler",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_scheduler.linux_amd64",
                  "path": "bonanza_scheduler"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_amd64: copy bonanza_storage_frontend",
               "run": "rm -f bonanza_storage_frontend && bazel run --run_under cp --platforms=@rules_go//go/toolchain:linux_amd64 //cmd/bonanza_storage_frontend $(pwd)/bonanza_storage_frontend"
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_amd64: upload bonanza_storage_frontend",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_storage_frontend.linux_amd64",
                  "path": "bonanza_storage_frontend"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_amd64: copy bonanza_storage_shard",
               "run": "rm -f bonanza_storage_shard && bazel run --run_under cp --platforms=@rules_go//go/toolchain:linux_amd64 //cmd/bonanza_storage_shard $(pwd)/bonanza_storage_shard"
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_amd64: upload bonanza_storage_shard",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_storage_shard.linux_amd64",
                  "path": "bonanza_storage_shard"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_amd64: copy bonanza_worker",
               "run": "rm -f bonanza_worker && bazel run --run_under cp --platforms=@rules_go//go/toolchain:linux_amd64 //cmd/bonanza_worker $(pwd)/bonanza_worker"
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_amd64: upload bonanza_worker",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_worker.linux_amd64",
                  "path": "bonanza_worker"
               }
            },
            {
               "if": "matrix.host.cross_compile || matrix.host.platform_name == 'linux_386'",
               "name": "linux_386: build${{ matrix.host.platform_name == 'linux_amd64' && ' and test' || '' }}",
               "run": "bazel ${{ matrix.host.platform_name == 'linux_amd64' && 'test --test_output=errors' || 'build' }} --platforms=@rules_go//go/toolchain:linux_386 //..."
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_386: copy bonanza_bazel",
               "run": "rm -f bonanza_bazel && bazel run --run_under cp --platforms=@rules_go//go/toolchain:linux_386 //cmd/bonanza_bazel $(pwd)/bonanza_bazel"
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_386: upload bonanza_bazel",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_bazel.linux_386",
                  "path": "bonanza_bazel"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_386: copy bonanza_browser",
               "run": "rm -f bonanza_browser && bazel run --run_under cp --platforms=@rules_go//go/toolchain:linux_386 //cmd/bonanza_browser $(pwd)/bonanza_browser"
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_386: upload bonanza_browser",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_browser.linux_386",
                  "path": "bonanza_browser"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_386: copy bonanza_builder",
               "run": "rm -f bonanza_builder && bazel run --run_under cp --platforms=@rules_go//go/toolchain:linux_386 //cmd/bonanza_builder $(pwd)/bonanza_builder"
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_386: upload bonanza_builder",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_builder.linux_386",
                  "path": "bonanza_builder"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_386: copy bonanza_fetcher",
               "run": "rm -f bonanza_fetcher && bazel run --run_under cp --platforms=@rules_go//go/toolchain:linux_386 //cmd/bonanza_fetcher $(pwd)/bonanza_fetcher"
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_386: upload bonanza_fetcher",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_fetcher.linux_386",
                  "path": "bonanza_fetcher"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_386: copy bonanza_scheduler",
               "run": "rm -f bonanza_scheduler && bazel run --run_under cp --platforms=@rules_go//go/toolchain:linux_386 //cmd/bonanza_scheduler $(pwd)/bonanza_scheduler"
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_386: upload bonanza_scheduler",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_scheduler.linux_386",
                  "path": "bonanza_scheduler"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_386: copy bonanza_storage_frontend",
               "run": "rm -f bonanza_storage_frontend && bazel run --run_under cp --platforms=@rules_go//go/toolchain:linux_386 //cmd/bonanza_storage_frontend $(pwd)/bonanza_storage_frontend"
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_386: upload bonanza_storage_frontend",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_storage_frontend.linux_386",
                  "path": "bonanza_storage_frontend"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_386: copy bonanza_storage_shard",
               "run": "rm -f bonanza_storage_shard && bazel run --run_under cp --platforms=@rules_go//go/toolchain:linux_386 //cmd/bonanza_storage_shard $(pwd)/bonanza_storage_shard"
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_386: upload bonanza_storage_shard",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_storage_shard.linux_386",
                  "path": "bonanza_storage_shard"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_386: copy bonanza_worker",
               "run": "rm -f bonanza_worker && bazel run --run_under cp --platforms=@rules_go//go/toolchain:linux_386 //cmd/bonanza_worker $(pwd)/bonanza_worker"
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_386: upload bonanza_worker",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_worker.linux_386",
                  "path": "bonanza_worker"
               }
            },
            {
               "if": "matrix.host.cross_compile || matrix.host.platform_name == 'linux_arm'",
               "name": "linux_arm: build${{ matrix.host.platform_name == 'linux_arm' && ' and test' || '' }}",
               "run": "bazel ${{ matrix.host.platform_name == 'linux_arm' && 'test --test_output=errors' || 'build' }} --platforms=@rules_go//go/toolchain:linux_arm //..."
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_arm: copy bonanza_bazel",
               "run": "rm -f bonanza_bazel && bazel run --run_under cp --platforms=@rules_go//go/toolchain:linux_arm //cmd/bonanza_bazel $(pwd)/bonanza_bazel"
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_arm: upload bonanza_bazel",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_bazel.linux_arm",
                  "path": "bonanza_bazel"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_arm: copy bonanza_browser",
               "run": "rm -f bonanza_browser && bazel run --run_under cp --platforms=@rules_go//go/toolchain:linux_arm //cmd/bonanza_browser $(pwd)/bonanza_browser"
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_arm: upload bonanza_browser",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_browser.linux_arm",
                  "path": "bonanza_browser"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_arm: copy bonanza_builder",
               "run": "rm -f bonanza_builder && bazel run --run_under cp --platforms=@rules_go//go/toolchain:linux_arm //cmd/bonanza_builder $(pwd)/bonanza_builder"
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_arm: upload bonanza_builder",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_builder.linux_arm",
                  "path": "bonanza_builder"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_arm: copy bonanza_fetcher",
               "run": "rm -f bonanza_fetcher && bazel run --run_under cp --platforms=@rules_go//go/toolchain:linux_arm //cmd/bonanza_fetcher $(pwd)/bonanza_fetcher"
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_arm: upload bonanza_fetcher",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_fetcher.linux_arm",
                  "path": "bonanza_fetcher"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_arm: copy bonanza_scheduler",
               "run": "rm -f bonanza_scheduler && bazel run --run_under cp --platforms=@rules_go//go/toolchain:linux_arm //cmd/bonanza_scheduler $(pwd)/bonanza_scheduler"
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_arm: upload bonanza_scheduler",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_scheduler.linux_arm",
                  "path": "bonanza_scheduler"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_arm: copy bonanza_storage_frontend",
               "run": "rm -f bonanza_storage_frontend && bazel run --run_under cp --platforms=@rules_go//go/toolchain:linux_arm //cmd/bonanza_storage_frontend $(pwd)/bonanza_storage_frontend"
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_arm: upload bonanza_storage_frontend",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_storage_frontend.linux_arm",
                  "path": "bonanza_storage_frontend"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_arm: copy bonanza_storage_shard",
               "run": "rm -f bonanza_storage_shard && bazel run --run_under cp --platforms=@rules_go//go/toolchain:linux_arm //cmd/bonanza_storage_shard $(pwd)/bonanza_storage_shard"
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_arm: upload bonanza_storage_shard",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_storage_shard.linux_arm",
                  "path": "bonanza_storage_shard"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_arm: copy bonanza_worker",
               "run": "rm -f bonanza_worker && bazel run --run_under cp --platforms=@rules_go//go/toolchain:linux_arm //cmd/bonanza_worker $(pwd)/bonanza_worker"
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_arm: upload bonanza_worker",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_worker.linux_arm",
                  "path": "bonanza_worker"
               }
            },
            {
               "if": "matrix.host.cross_compile || matrix.host.platform_name == 'linux_arm64'",
               "name": "linux_arm64: build${{ matrix.host.platform_name == 'linux_arm64' && ' and test' || '' }}",
               "run": "bazel ${{ matrix.host.platform_name == 'linux_arm64' && 'test --test_output=errors' || 'build' }} --platforms=@rules_go//go/toolchain:linux_arm64 //..."
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_arm64: copy bonanza_bazel",
               "run": "rm -f bonanza_bazel && bazel run --run_under cp --platforms=@rules_go//go/toolchain:linux_arm64 //cmd/bonanza_bazel $(pwd)/bonanza_bazel"
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_arm64: upload bonanza_bazel",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_bazel.linux_arm64",
                  "path": "bonanza_bazel"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_arm64: copy bonanza_browser",
               "run": "rm -f bonanza_browser && bazel run --run_under cp --platforms=@rules_go//go/toolchain:linux_arm64 //cmd/bonanza_browser $(pwd)/bonanza_browser"
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_arm64: upload bonanza_browser",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_browser.linux_arm64",
                  "path": "bonanza_browser"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_arm64: copy bonanza_builder",
               "run": "rm -f bonanza_builder && bazel run --run_under cp --platforms=@rules_go//go/toolchain:linux_arm64 //cmd/bonanza_builder $(pwd)/bonanza_builder"
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_arm64: upload bonanza_builder",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_builder.linux_arm64",
                  "path": "bonanza_builder"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_arm64: copy bonanza_fetcher",
               "run": "rm -f bonanza_fetcher && bazel run --run_under cp --platforms=@rules_go//go/toolchain:linux_arm64 //cmd/bonanza_fetcher $(pwd)/bonanza_fetcher"
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_arm64: upload bonanza_fetcher",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_fetcher.linux_arm64",
                  "path": "bonanza_fetcher"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_arm64: copy bonanza_scheduler",
               "run": "rm -f bonanza_scheduler && bazel run --run_under cp --platforms=@rules_go//go/toolchain:linux_arm64 //cmd/bonanza_scheduler $(pwd)/bonanza_scheduler"
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_arm64: upload bonanza_scheduler",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_scheduler.linux_arm64",
                  "path": "bonanza_scheduler"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_arm64: copy bonanza_storage_frontend",
               "run": "rm -f bonanza_storage_frontend && bazel run --run_under cp --platforms=@rules_go//go/toolchain:linux_arm64 //cmd/bonanza_storage_frontend $(pwd)/bonanza_storage_frontend"
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_arm64: upload bonanza_storage_frontend",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_storage_frontend.linux_arm64",
                  "path": "bonanza_storage_frontend"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_arm64: copy bonanza_storage_shard",
               "run": "rm -f bonanza_storage_shard && bazel run --run_under cp --platforms=@rules_go//go/toolchain:linux_arm64 //cmd/bonanza_storage_shard $(pwd)/bonanza_storage_shard"
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_arm64: upload bonanza_storage_shard",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_storage_shard.linux_arm64",
                  "path": "bonanza_storage_shard"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_arm64: copy bonanza_worker",
               "run": "rm -f bonanza_worker && bazel run --run_under cp --platforms=@rules_go//go/toolchain:linux_arm64 //cmd/bonanza_worker $(pwd)/bonanza_worker"
            },
            {
               "if": "matrix.host.upload",
               "name": "linux_arm64: upload bonanza_worker",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_worker.linux_arm64",
                  "path": "bonanza_worker"
               }
            },
            {
               "if": "matrix.host.cross_compile || matrix.host.platform_name == 'darwin_amd64'",
               "name": "darwin_amd64: build${{ matrix.host.platform_name == 'darwin_amd64' && ' and test' || '' }}",
               "run": "bazel ${{ matrix.host.platform_name == 'darwin_amd64' && 'test --test_output=errors' || 'build' }} --platforms=@rules_go//go/toolchain:darwin_amd64 //..."
            },
            {
               "if": "matrix.host.upload",
               "name": "darwin_amd64: copy bonanza_bazel",
               "run": "rm -f bonanza_bazel && bazel run --run_under cp --platforms=@rules_go//go/toolchain:darwin_amd64 //cmd/bonanza_bazel $(pwd)/bonanza_bazel"
            },
            {
               "if": "matrix.host.upload",
               "name": "darwin_amd64: upload bonanza_bazel",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_bazel.darwin_amd64",
                  "path": "bonanza_bazel"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "darwin_amd64: copy bonanza_browser",
               "run": "rm -f bonanza_browser && bazel run --run_under cp --platforms=@rules_go//go/toolchain:darwin_amd64 //cmd/bonanza_browser $(pwd)/bonanza_browser"
            },
            {
               "if": "matrix.host.upload",
               "name": "darwin_amd64: upload bonanza_browser",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_browser.darwin_amd64",
                  "path": "bonanza_browser"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "darwin_amd64: copy bonanza_builder",
               "run": "rm -f bonanza_builder && bazel run --run_under cp --platforms=@rules_go//go/toolchain:darwin_amd64 //cmd/bonanza_builder $(pwd)/bonanza_builder"
            },
            {
               "if": "matrix.host.upload",
               "name": "darwin_amd64: upload bonanza_builder",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_builder.darwin_amd64",
                  "path": "bonanza_builder"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "darwin_amd64: copy bonanza_fetcher",
               "run": "rm -f bonanza_fetcher && bazel run --run_under cp --platforms=@rules_go//go/toolchain:darwin_amd64 //cmd/bonanza_fetcher $(pwd)/bonanza_fetcher"
            },
            {
               "if": "matrix.host.upload",
               "name": "darwin_amd64: upload bonanza_fetcher",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_fetcher.darwin_amd64",
                  "path": "bonanza_fetcher"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "darwin_amd64: copy bonanza_scheduler",
               "run": "rm -f bonanza_scheduler && bazel run --run_under cp --platforms=@rules_go//go/toolchain:darwin_amd64 //cmd/bonanza_scheduler $(pwd)/bonanza_scheduler"
            },
            {
               "if": "matrix.host.upload",
               "name": "darwin_amd64: upload bonanza_scheduler",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_scheduler.darwin_amd64",
                  "path": "bonanza_scheduler"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "darwin_amd64: copy bonanza_storage_frontend",
               "run": "rm -f bonanza_storage_frontend && bazel run --run_under cp --platforms=@rules_go//go/toolchain:darwin_amd64 //cmd/bonanza_storage_frontend $(pwd)/bonanza_storage_frontend"
            },
            {
               "if": "matrix.host.upload",
               "name": "darwin_amd64: upload bonanza_storage_frontend",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_storage_frontend.darwin_amd64",
                  "path": "bonanza_storage_frontend"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "darwin_amd64: copy bonanza_storage_shard",
               "run": "rm -f bonanza_storage_shard && bazel run --run_under cp --platforms=@rules_go//go/toolchain:darwin_amd64 //cmd/bonanza_storage_shard $(pwd)/bonanza_storage_shard"
            },
            {
               "if": "matrix.host.upload",
               "name": "darwin_amd64: upload bonanza_storage_shard",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_storage_shard.darwin_amd64",
                  "path": "bonanza_storage_shard"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "darwin_amd64: copy bonanza_worker",
               "run": "rm -f bonanza_worker && bazel run --run_under cp --platforms=@rules_go//go/toolchain:darwin_amd64 //cmd/bonanza_worker $(pwd)/bonanza_worker"
            },
            {
               "if": "matrix.host.upload",
               "name": "darwin_amd64: upload bonanza_worker",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_worker.darwin_amd64",
                  "path": "bonanza_worker"
               }
            },
            {
               "if": "matrix.host.cross_compile || matrix.host.platform_name == 'darwin_arm64'",
               "name": "darwin_arm64: build${{ matrix.host.platform_name == 'darwin_arm64' && ' and test' || '' }}",
               "run": "bazel ${{ matrix.host.platform_name == 'darwin_arm64' && 'test --test_output=errors' || 'build' }} --platforms=@rules_go//go/toolchain:darwin_arm64 //..."
            },
            {
               "if": "matrix.host.upload",
               "name": "darwin_arm64: copy bonanza_bazel",
               "run": "rm -f bonanza_bazel && bazel run --run_under cp --platforms=@rules_go//go/toolchain:darwin_arm64 //cmd/bonanza_bazel $(pwd)/bonanza_bazel"
            },
            {
               "if": "matrix.host.upload",
               "name": "darwin_arm64: upload bonanza_bazel",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_bazel.darwin_arm64",
                  "path": "bonanza_bazel"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "darwin_arm64: copy bonanza_browser",
               "run": "rm -f bonanza_browser && bazel run --run_under cp --platforms=@rules_go//go/toolchain:darwin_arm64 //cmd/bonanza_browser $(pwd)/bonanza_browser"
            },
            {
               "if": "matrix.host.upload",
               "name": "darwin_arm64: upload bonanza_browser",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_browser.darwin_arm64",
                  "path": "bonanza_browser"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "darwin_arm64: copy bonanza_builder",
               "run": "rm -f bonanza_builder && bazel run --run_under cp --platforms=@rules_go//go/toolchain:darwin_arm64 //cmd/bonanza_builder $(pwd)/bonanza_builder"
            },
            {
               "if": "matrix.host.upload",
               "name": "darwin_arm64: upload bonanza_builder",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_builder.darwin_arm64",
                  "path": "bonanza_builder"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "darwin_arm64: copy bonanza_fetcher",
               "run": "rm -f bonanza_fetcher && bazel run --run_under cp --platforms=@rules_go//go/toolchain:darwin_arm64 //cmd/bonanza_fetcher $(pwd)/bonanza_fetcher"
            },
            {
               "if": "matrix.host.upload",
               "name": "darwin_arm64: upload bonanza_fetcher",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_fetcher.darwin_arm64",
                  "path": "bonanza_fetcher"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "darwin_arm64: copy bonanza_scheduler",
               "run": "rm -f bonanza_scheduler && bazel run --run_under cp --platforms=@rules_go//go/toolchain:darwin_arm64 //cmd/bonanza_scheduler $(pwd)/bonanza_scheduler"
            },
            {
               "if": "matrix.host.upload",
               "name": "darwin_arm64: upload bonanza_scheduler",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_scheduler.darwin_arm64",
                  "path": "bonanza_scheduler"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "darwin_arm64: copy bonanza_storage_frontend",
               "run": "rm -f bonanza_storage_frontend && bazel run --run_under cp --platforms=@rules_go//go/toolchain:darwin_arm64 //cmd/bonanza_storage_frontend $(pwd)/bonanza_storage_frontend"
            },
            {
               "if": "matrix.host.upload",
               "name": "darwin_arm64: upload bonanza_storage_frontend",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_storage_frontend.darwin_arm64",
                  "path": "bonanza_storage_frontend"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "darwin_arm64: copy bonanza_storage_shard",
               "run": "rm -f bonanza_storage_shard && bazel run --run_under cp --platforms=@rules_go//go/toolchain:darwin_arm64 //cmd/bonanza_storage_shard $(pwd)/bonanza_storage_shard"
            },
            {
               "if": "matrix.host.upload",
               "name": "darwin_arm64: upload bonanza_storage_shard",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_storage_shard.darwin_arm64",
                  "path": "bonanza_storage_shard"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "darwin_arm64: copy bonanza_worker",
               "run": "rm -f bonanza_worker && bazel run --run_under cp --platforms=@rules_go//go/toolchain:darwin_arm64 //cmd/bonanza_worker $(pwd)/bonanza_worker"
            },
            {
               "if": "matrix.host.upload",
               "name": "darwin_arm64: upload bonanza_worker",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_worker.darwin_arm64",
                  "path": "bonanza_worker"
               }
            },
            {
               "if": "matrix.host.cross_compile || matrix.host.platform_name == 'freebsd_amd64'",
               "name": "freebsd_amd64: build${{ matrix.host.platform_name == 'freebsd_amd64' && ' and test' || '' }}",
               "run": "bazel ${{ matrix.host.platform_name == 'freebsd_amd64' && 'test --test_output=errors' || 'build' }} --platforms=@rules_go//go/toolchain:freebsd_amd64 //..."
            },
            {
               "if": "matrix.host.upload",
               "name": "freebsd_amd64: copy bonanza_bazel",
               "run": "rm -f bonanza_bazel && bazel run --run_under cp --platforms=@rules_go//go/toolchain:freebsd_amd64 //cmd/bonanza_bazel $(pwd)/bonanza_bazel"
            },
            {
               "if": "matrix.host.upload",
               "name": "freebsd_amd64: upload bonanza_bazel",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_bazel.freebsd_amd64",
                  "path": "bonanza_bazel"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "freebsd_amd64: copy bonanza_browser",
               "run": "rm -f bonanza_browser && bazel run --run_under cp --platforms=@rules_go//go/toolchain:freebsd_amd64 //cmd/bonanza_browser $(pwd)/bonanza_browser"
            },
            {
               "if": "matrix.host.upload",
               "name": "freebsd_amd64: upload bonanza_browser",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_browser.freebsd_amd64",
                  "path": "bonanza_browser"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "freebsd_amd64: copy bonanza_builder",
               "run": "rm -f bonanza_builder && bazel run --run_under cp --platforms=@rules_go//go/toolchain:freebsd_amd64 //cmd/bonanza_builder $(pwd)/bonanza_builder"
            },
            {
               "if": "matrix.host.upload",
               "name": "freebsd_amd64: upload bonanza_builder",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_builder.freebsd_amd64",
                  "path": "bonanza_builder"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "freebsd_amd64: copy bonanza_fetcher",
               "run": "rm -f bonanza_fetcher && bazel run --run_under cp --platforms=@rules_go//go/toolchain:freebsd_amd64 //cmd/bonanza_fetcher $(pwd)/bonanza_fetcher"
            },
            {
               "if": "matrix.host.upload",
               "name": "freebsd_amd64: upload bonanza_fetcher",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_fetcher.freebsd_amd64",
                  "path": "bonanza_fetcher"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "freebsd_amd64: copy bonanza_scheduler",
               "run": "rm -f bonanza_scheduler && bazel run --run_under cp --platforms=@rules_go//go/toolchain:freebsd_amd64 //cmd/bonanza_scheduler $(pwd)/bonanza_scheduler"
            },
            {
               "if": "matrix.host.upload",
               "name": "freebsd_amd64: upload bonanza_scheduler",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_scheduler.freebsd_amd64",
                  "path": "bonanza_scheduler"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "freebsd_amd64: copy bonanza_storage_frontend",
               "run": "rm -f bonanza_storage_frontend && bazel run --run_under cp --platforms=@rules_go//go/toolchain:freebsd_amd64 //cmd/bonanza_storage_frontend $(pwd)/bonanza_storage_frontend"
            },
            {
               "if": "matrix.host.upload",
               "name": "freebsd_amd64: upload bonanza_storage_frontend",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_storage_frontend.freebsd_amd64",
                  "path": "bonanza_storage_frontend"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "freebsd_amd64: copy bonanza_storage_shard",
               "run": "rm -f bonanza_storage_shard && bazel run --run_under cp --platforms=@rules_go//go/toolchain:freebsd_amd64 //cmd/bonanza_storage_shard $(pwd)/bonanza_storage_shard"
            },
            {
               "if": "matrix.host.upload",
               "name": "freebsd_amd64: upload bonanza_storage_shard",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_storage_shard.freebsd_amd64",
                  "path": "bonanza_storage_shard"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "freebsd_amd64: copy bonanza_worker",
               "run": "rm -f bonanza_worker && bazel run --run_under cp --platforms=@rules_go//go/toolchain:freebsd_amd64 //cmd/bonanza_worker $(pwd)/bonanza_worker"
            },
            {
               "if": "matrix.host.upload",
               "name": "freebsd_amd64: upload bonanza_worker",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_worker.freebsd_amd64",
                  "path": "bonanza_worker"
               }
            },
            {
               "if": "matrix.host.cross_compile || matrix.host.platform_name == 'windows_amd64'",
               "name": "windows_amd64: build${{ matrix.host.platform_name == 'windows_amd64' && ' and test' || '' }}",
               "run": "bazel ${{ matrix.host.platform_name == 'windows_amd64' && 'test --test_output=errors' || 'build' }} --platforms=@rules_go//go/toolchain:windows_amd64 //..."
            },
            {
               "if": "matrix.host.upload",
               "name": "windows_amd64: copy bonanza_bazel",
               "run": "rm -f bonanza_bazel.exe && bazel run --run_under cp --platforms=@rules_go//go/toolchain:windows_amd64 //cmd/bonanza_bazel $(pwd)/bonanza_bazel.exe"
            },
            {
               "if": "matrix.host.upload",
               "name": "windows_amd64: upload bonanza_bazel",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_bazel.windows_amd64",
                  "path": "bonanza_bazel.exe"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "windows_amd64: copy bonanza_browser",
               "run": "rm -f bonanza_browser.exe && bazel run --run_under cp --platforms=@rules_go//go/toolchain:windows_amd64 //cmd/bonanza_browser $(pwd)/bonanza_browser.exe"
            },
            {
               "if": "matrix.host.upload",
               "name": "windows_amd64: upload bonanza_browser",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_browser.windows_amd64",
                  "path": "bonanza_browser.exe"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "windows_amd64: copy bonanza_builder",
               "run": "rm -f bonanza_builder.exe && bazel run --run_under cp --platforms=@rules_go//go/toolchain:windows_amd64 //cmd/bonanza_builder $(pwd)/bonanza_builder.exe"
            },
            {
               "if": "matrix.host.upload",
               "name": "windows_amd64: upload bonanza_builder",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_builder.windows_amd64",
                  "path": "bonanza_builder.exe"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "windows_amd64: copy bonanza_fetcher",
               "run": "rm -f bonanza_fetcher.exe && bazel run --run_under cp --platforms=@rules_go//go/toolchain:windows_amd64 //cmd/bonanza_fetcher $(pwd)/bonanza_fetcher.exe"
            },
            {
               "if": "matrix.host.upload",
               "name": "windows_amd64: upload bonanza_fetcher",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_fetcher.windows_amd64",
                  "path": "bonanza_fetcher.exe"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "windows_amd64: copy bonanza_scheduler",
               "run": "rm -f bonanza_scheduler.exe && bazel run --run_under cp --platforms=@rules_go//go/toolchain:windows_amd64 //cmd/bonanza_scheduler $(pwd)/bonanza_scheduler.exe"
            },
            {
               "if": "matrix.host.upload",
               "name": "windows_amd64: upload bonanza_scheduler",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_scheduler.windows_amd64",
                  "path": "bonanza_scheduler.exe"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "windows_amd64: copy bonanza_storage_frontend",
               "run": "rm -f bonanza_storage_frontend.exe && bazel run --run_under cp --platforms=@rules_go//go/toolchain:windows_amd64 //cmd/bonanza_storage_frontend $(pwd)/bonanza_storage_frontend.exe"
            },
            {
               "if": "matrix.host.upload",
               "name": "windows_amd64: upload bonanza_storage_frontend",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_storage_frontend.windows_amd64",
                  "path": "bonanza_storage_frontend.exe"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "windows_amd64: copy bonanza_storage_shard",
               "run": "rm -f bonanza_storage_shard.exe && bazel run --run_under cp --platforms=@rules_go//go/toolchain:windows_amd64 //cmd/bonanza_storage_shard $(pwd)/bonanza_storage_shard.exe"
            },
            {
               "if": "matrix.host.upload",
               "name": "windows_amd64: upload bonanza_storage_shard",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_storage_shard.windows_amd64",
                  "path": "bonanza_storage_shard.exe"
               }
            },
            {
               "if": "matrix.host.upload",
               "name": "windows_amd64: copy bonanza_worker",
               "run": "rm -f bonanza_worker.exe && bazel run --run_under cp --platforms=@rules_go//go/toolchain:windows_amd64 //cmd/bonanza_worker $(pwd)/bonanza_worker.exe"
            },
            {
               "if": "matrix.host.upload",
               "name": "windows_amd64: upload bonanza_worker",
               "uses": "actions/upload-artifact@v4",
               "with": {
                  "name": "bonanza_worker.windows_amd64",
                  "path": "bonanza_worker.exe"
               }
            },
            {
               "env": {
                  "GITHUB_TOKEN": "${{ secrets.GITHUB_TOKEN }}"
               },
               "if": "matrix.host.upload",
               "name": "Install Docker credentials",
               "run": "echo \"${GITHUB_TOKEN}\" | docker login ghcr.io -u $ --password-stdin"
            },
            {
               "if": "matrix.host.upload",
               "name": "Push container bonanza_browser:bonanza_browser",
               "run": "bazel run --stamp //cmd/bonanza_browser:bonanza_browser_container_push"
            },
            {
               "if": "matrix.host.upload",
               "name": "Push container bonanza_builder:bonanza_builder",
               "run": "bazel run --stamp //cmd/bonanza_builder:bonanza_builder_container_push"
            },
            {
               "if": "matrix.host.upload",
               "name": "Push container bonanza_fetcher:bonanza_fetcher",
               "run": "bazel run --stamp //cmd/bonanza_fetcher:bonanza_fetcher_container_push"
            },
            {
               "if": "matrix.host.upload",
               "name": "Push container bonanza_scheduler:bonanza_scheduler",
               "run": "bazel run --stamp //cmd/bonanza_scheduler:bonanza_scheduler_container_push"
            },
            {
               "if": "matrix.host.upload",
               "name": "Push container bonanza_storage_frontend:bonanza_storage_frontend",
               "run": "bazel run --stamp //cmd/bonanza_storage_frontend:bonanza_storage_frontend_container_push"
            },
            {
               "if": "matrix.host.upload",
               "name": "Push container bonanza_storage_shard:bonanza_storage_shard",
               "run": "bazel run --stamp //cmd/bonanza_storage_shard:bonanza_storage_shard_container_push"
            },
            {
               "if": "matrix.host.upload",
               "name": "Push container bonanza_worker:bonanza_worker",
               "run": "bazel run --stamp //cmd/bonanza_worker:bonanza_worker_container_push"
            }
         ],
         "strategy": {
            "matrix": {
               "host": [
                  {
                     "bazel_os": "linux",
                     "cross_compile": true,
                     "lint": true,
                     "os": "ubuntu-latest",
                     "platform_name": "linux_amd64",
                     "upload": true
                  },
                  {
                     "bazel_os": "windows",
                     "cross_compile": false,
                     "lint": false,
                     "os": "windows-latest",
                     "platform_name": "windows_amd64",
                     "upload": false
                  }
               ]
            }
         }
      }
   },
   "name": "master",
   "on": {
      "push": {
         "branches": [
            "main",
            "master"
         ]
      }
   }
}
